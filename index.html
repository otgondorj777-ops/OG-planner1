<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>OG planner app</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#ffffff" />

  <!-- Manifest -->
  <link rel="manifest" href="manifest.json" />

  <!-- Basic reset + font -->
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, system-ui, -system-ui, BlinkMacSystemFont, "SF Pro Text", sans-serif;
      background: radial-gradient(circle at top left, #e0f2ff, #f5f7ff);
      padding: 24px;
      color: #111827;
    }
    .app-shell {
      max-width: 480px;
      margin: 0 auto;
      background: #ffffff;
      border-radius: 28px;
      padding: 24px 24px 20px;
      box-shadow:
        0 18px 45px rgba(15, 23, 42, 0.16),
        0 0 0 1px rgba(148, 163, 184, 0.15);
    }
    .badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 6px 12px;
      border-radius: 999px;
      background: #ecfdf3;
      color: #15803d;
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 16px;
    }
    .badge-dot {
      width: 10px;
      height: 10px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.18);
    }
    h1 {
      font-size: 26px;
      font-weight: 750;
      letter-spacing: -0.03em;
      margin-bottom: 6px;
    }
    .sub {
      font-size: 14px;
      color: #6b7280;
      margin-bottom: 18px;
    }
    .pill-primary {
      width: 100%;
      border-radius: 999px;
      padding: 12px 18px;
      border: none;
      color: #f9fafb;
      font-weight: 600;
      font-size: 15px;
      cursor: pointer;
      background: linear-gradient(135deg, #22c55e, #0ea5e9);
      box-shadow:
        0 16px 40px rgba(8, 47, 73, 0.35),
        0 0 0 1px rgba(59, 130, 246, 0.2);
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 8px;
      margin-bottom: 20px;
    }
    .pill-primary span {
      font-size: 18px;
    }
    .field-label {
      font-size: 13px;
      font-weight: 600;
      color: #6b7280;
      margin-bottom: 6px;
    }
    .tz-toggle {
      display: inline-flex;
      border-radius: 999px;
      padding: 3px;
      background: #f3f4ff;
      margin-bottom: 18px;
    }
    .tz-toggle button {
      border: none;
      border-radius: 999px;
      padding: 7px 14px;
      font-size: 13px;
      font-weight: 600;
      color: #6b7280;
      background: transparent;
      cursor: pointer;
      min-width: 90px;
    }
    .tz-toggle button.active {
      background: #2563eb;
      color: #f9fafb;
      box-shadow: 0 10px 25px rgba(37, 99, 235, 0.45);
    }
    .field {
      margin-bottom: 14px;
    }
    .input, .input-inline {
      width: 100%;
      border-radius: 16px;
      border: 1px solid #e5e7eb;
      padding: 10px 12px;
      font-size: 14px;
      background: #f9fafb;
      outline: none;
      transition: border-color 0.12s ease, box-shadow 0.12s ease, background 0.12s;
    }
    .input:focus, .input-inline:focus {
      border-color: #2563eb;
      background: #ffffff;
      box-shadow: 0 0 0 1px rgba(37, 99, 235, 0.2);
    }
    .row-2 {
      display: flex;
      gap: 10px;
    }
    textarea.input {
      resize: vertical;
      min-height: 60px;
    }
    .save-btn {
      margin-top: 6px;
      margin-bottom: 20px;
    }
    .filter-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 10px;
      gap: 12px;
    }
    .filters {
      display: inline-flex;
      border-radius: 999px;
      padding: 3px;
      background: #f3f4ff;
    }
    .filters button {
      border: none;
      border-radius: 999px;
      padding: 6px 12px;
      font-size: 12px;
      font-weight: 600;
      color: #6b7280;
      background: transparent;
      cursor: pointer;
      min-width: 70px;
    }
    .filters button.active {
      background: #111827;
      color: #f9fafb;
    }
    .view-toggle {
      display: inline-flex;
      border-radius: 999px;
      padding: 3px;
      background: #ede9fe;
    }
    .view-toggle button {
      border: none;
      border-radius: 999px;
      padding: 6px 12px;
      font-size: 12px;
      font-weight: 600;
      color: #6b7280;
      background: transparent;
      cursor: pointer;
      min-width: 68px;
    }
    .view-toggle button.active {
      background: #4f46e5;
      color: #f9fafb;
    }
    .task-card {
      margin-top: 10px;
      border-radius: 18px;
      padding: 12px 12px 10px;
      background: #f9fafb;
      border: 1px solid #e5e7eb;
    }
    .task-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
    }
    .task-title {
      font-size: 14px;
      font-weight: 600;
    }
    .tz-chip {
      font-size: 11px;
      font-weight: 600;
      padding: 4px 8px;
      border-radius: 999px;
      background: #ecfeff;
      color: #0369a1;
    }
    .task-line {
      font-size: 12px;
      color: #4b5563;
    }
    .task-line + .task-line { margin-top: 2px; }
    .task-notes {
      margin-top: 6px;
      font-size: 12px;
      color: #6b7280;
    }
    .task-actions {
      margin-top: 8px;
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
    }
    .pill-btn {
      border-radius: 999px;
      border: none;
      padding: 5px 10px;
      font-size: 11px;
      font-weight: 600;
      cursor: pointer;
      background: #e5f3ff;
      color: #1d4ed8;
    }
    .pill-btn.ghost {
      background: #f3f4f6;
      color: #374151;
    }
    .pill-btn.danger {
      background: #fee2e2;
      color: #b91c1c;
    }
    .empty-state {
      margin-top: 10px;
      font-size: 12px;
      color: #9ca3af;
    }
    .footer {
      margin-top: 16px;
      font-size: 11px;
      color: #6b7280;
    }
    .footer strong { color: #111827; }
    .view-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 4px;
    }
    @media (max-width: 480px) {
      body { padding: 16px; }
      .app-shell { border-radius: 24px; padding: 20px 18px 16px; }
      .view-row { margin-top: 8px; }
    }
  </style>
</head>

<body>
  <div class="app-shell">
    <div class="badge">
      <span class="badge-dot"></span>
      <span>OG planner app</span>
    </div>

    <h1>Today‚Äôs focus</h1>
    <p class="sub">Plan once, see both time zones. Mongolia &amp; Pennsylvania side-by-side.</p>

    <button class="pill-primary">
      <span>üîî</span>
      <span>Enable reminders (tab open)</span>
    </button>

    <div class="field-label">Time zone mode</div>
    <div class="tz-toggle" id="tzModeToggle">
      <button type="button" data-mode="MN_PA" class="active">MN ‚Üí PA</button>
      <button type="button" data-mode="PA_MN">PA ‚Üí MN</button>
    </div>

    <form id="taskForm" autocomplete="off">
      <div class="field">
        <div class="field-label">Title</div>
        <input id="titleInput" class="input" placeholder="Write your main task..." />
      </div>

      <div class="field">
        <div class="field-label">Date</div>
        <div class="row-2">
          <input id="dateInput" type="date" class="input-inline" />
          <input id="timeInput" type="time" class="input-inline" />
        </div>
      </div>

      <div class="field">
        <div class="field-label">Notes (optional)</div>
        <textarea id="notesInput" class="input" placeholder="Details, links, or context..."></textarea>
      </div>

      <button type="submit" class="pill-primary save-btn">
        <span>Ôºã</span>
        <span>Save task with both time zones</span>
      </button>
    </form>

    <div class="filter-row">
      <div class="filters">
        <button type="button" data-filter="all" class="active">All</button>
        <button type="button" data-filter="today">Today</button>
        <button type="button" data-filter="upcoming">Upcoming</button>
        <button type="button" data-filter="done">Done</button>
      </div>
      <div class="view-toggle" id="viewToggle">
        <button type="button" data-view="list" class="active">List</button>
        <button type="button" data-view="calendar">Calendar</button>
      </div>
    </div>

    <div id="listWrapper">
      <div id="tasksContainer"></div>
    </div>

    <div id="calendarWrapper" style="display:none;">
      <div id="calendarGrid" class="empty-state">Calendar view coming soon‚Ä¶</div>
    </div>

    <div class="footer">
      Best regards,<br />
      <strong>OTGONDORJ Luvsandagva</strong><br />
      ‚ÄúWaiting for the ‚Äòperfect time‚Äô usually means never starting.‚Äù
    </div>
  </div>

 <script>
  console.log("INDEX JS LOADED");

  // ===========================
  // Service worker registration
  // ===========================
  if ("serviceWorker" in navigator) {
    window.addEventListener("load", () => {
      navigator.serviceWorker
        .register("./service-worker.js")
        .then((registration) => {
          console.log("Service worker registered with scope:", registration.scope);
        })
        .catch((error) => {
          console.error("Service worker registration failed:", error);
        });
    });
  }

  // ===========================
  // OG Planner App main script
  // ===========================

  const form = document.getElementById("taskForm");
  const titleInput = document.getElementById("titleInput");
  const dateInput = document.getElementById("dateInput");
  const timeInput = document.getElementById("timeInput");
  const notesInput = document.getElementById("notesInput");

  const tzModeToggle = document.getElementById("tzModeToggle");
  const filterButtons = document.querySelectorAll("[data-filter]");
  const tasksContainer = document.getElementById("tasksContainer");

  const viewToggle = document.getElementById("viewToggle");
  const listWrapper = document.getElementById("listWrapper");
  const calendarWrapper = document.getElementById("calendarWrapper");

  let tzMode = "MN_PA";
  let tasks = [];

  const MN_TZ = "Asia/Ulaanbaatar";
  const PA_TZ = "America/New_York";

  function parseLocalDateTime(dateStr, timeStr, timeZone) {
    const [year, month, day] = dateStr.split("-").map(Number);
    const [hour, minute] = timeStr.split(":").map(Number);
    const date = new Date(Date.UTC(year, month - 1, day, hour, minute));
    const tzDate = new Date(date.toLocaleString("en-US", { timeZone }));
    return tzDate;
  }

  function formatInTimeZone(date, timeZone, opts = {}) {
    return date.toLocaleString("en-US", {
      timeZone,
      ...opts
    });
  }

  function createTask({ title, notes, baseDate, baseTime, mode }) {
    const sourceTz = mode === "MN_PA" ? MN_TZ : PA_TZ;
    const sourceDate = parseLocalDateTime(baseDate, baseTime, sourceTz);

    return {
      id: crypto.randomUUID(),
      title,
      notes,
      mode,
      createdAt: new Date().toISOString(),
      sourceDateISO: sourceDate.toISOString(),
      done: false
    };
  }

  function saveTasks() {
    localStorage.setItem("ogPlannerTasks", JSON.stringify(tasks));
  }

  function loadTasks() {
    const raw = localStorage.getItem("ogPlannerTasks");
    if (!raw) return;
    try { tasks = JSON.parse(raw); } catch { tasks = []; }
  }

  function updateTzModeUI() {
    const buttons = tzModeToggle.querySelectorAll("button");
    buttons.forEach((b) => {
      b.classList.toggle("active", b.dataset.mode === tzMode);
    });
  }

  function getActiveFilter() {
    const btn = document.querySelector("[data-filter].active");
    return btn ? btn.dataset.filter : "all";
  }

  function renderTasks(filter = "all") {
    tasksContainer.innerHTML = "";
    let filtered = tasks.slice();
    const now = new Date();

    if (filter === "today") {
      filtered = filtered.filter((t) => {
        const d = new Date(t.sourceDateISO);
        return (
          d.getFullYear() === now.getFullYear() &&
          d.getMonth() === now.getMonth() &&
          d.getDate() === now.getDate()
        );
      });
    } else if (filter === "upcoming") {
      filtered = filtered.filter((t) => new Date(t.sourceDateISO) > now);
    } else if (filter === "done") {
      filtered = filtered.filter((t) => t.done);
    }

    if (!filtered.length) {
      const empty = document.createElement("div");
      empty.className = "empty-state";
      empty.textContent = "No tasks yet. Add your first focus block.";
      tasksContainer.appendChild(empty);
      return;
    }

    filtered
      .sort((a, b) => new Date(a.sourceDateISO) - new Date(b.sourceDateISO))
      .forEach((task) => {
        const card = document.createElement("div");
        card.className = "task-card";

        const header = document.createElement("div");
        header.className = "task-header";

        const titleEl = document.createElement("div");
        titleEl.className = "task-title";
        titleEl.textContent = task.title || "(No title)";

        const tzChip = document.createElement("span");
        tzChip.className = "tz-chip";
        tzChip.textContent = task.mode === "MN_PA" ? "MN ‚Üí PA" : "PA ‚Üí MN";

        header.appendChild(titleEl);
        header.appendChild(tzChip);

        const body = document.createElement("div");
        body.className = "task-body";

        const line1 = document.createElement("div");
        line1.className = "task-line";
        line1.innerHTML =
          "<strong>MN:</strong> " +
          formatInTimeZone(new Date(task.sourceDateISO), MN_TZ, {
            year: "numeric",
            month: "short",
            day: "2-digit",
            hour: "2-digit",
            minute: "2-digit",
            hour12: false
          });

        const line2 = document.createElement("div");
        line2.className = "task-line";
        line2.innerHTML =
          "<strong>PA:</strong> " +
          formatInTimeZone(new Date(task.sourceDateISO), PA_TZ, {
            year: "numeric",
            month: "short",
            day: "2-digit",
            hour: "2-digit",
            minute: "2-digit",
            hour12: false
          });

        body.appendChild(line1);
        body.appendChild(line2);

        if (task.notes) {
          const notes = document.createElement("div");
          notes.className = "task-notes";
          notes.textContent = task.notes;
          body.appendChild(notes);
        }

        const actions = document.createElement("div");
        actions.className = "task-actions";

        const doneBtn = document.createElement("button");
        doneBtn.type = "button";
        doneBtn.className = "pill-btn";
        doneBtn.textContent = task.done ? "‚úì Done" : "Mark done";
        doneBtn.addEventListener("click", () => {
          task.done = !task.done;
          saveTasks();
          renderTasks(getActiveFilter());
        });

        const deleteBtn = document.createElement("button");
        deleteBtn.type = "button";
        deleteBtn.className = "pill-btn danger";
        deleteBtn.textContent = "Delete";
        deleteBtn.addEventListener("click", () => {
          tasks = tasks.filter((t) => t.id !== task.id);
          saveTasks();
          renderTasks(getActiveFilter());
        });

        actions.appendChild(doneBtn);
        actions.appendChild(deleteBtn);

        card.appendChild(header);
        card.appendChild(body);
        card.appendChild(actions);

        tasksContainer.appendChild(card);
      });
  }

  tzModeToggle.addEventListener("click", (e) => {
    const btn = e.target.closest("[data-mode]");
    if (!btn) return;
    tzMode = btn.dataset.mode;
    updateTzModeUI();
  });

  form.addEventListener("submit", (e) => {
    e.preventDefault();
    const title = titleInput.value.trim();
    const notes = notesInput.value.trim();
    const date = dateInput.value;
    const time = timeInput.value;

    if (!date || !time) {
      alert("Please choose date and time.");
      return;
    }

    const task = createTask({
      title,
      notes,
      baseDate: date,
      baseTime: time,
      mode: tzMode
    });

    tasks.push(task);
    saveTasks();
    form.reset();
    renderTasks(getActiveFilter());
  });

  filterButtons.forEach((btn) => {
    btn.addEventListener("click", () => {
      filterButtons.forEach((b) => b.classList.remove("active"));
      btn.classList.add("active");
      renderTasks(btn.dataset.filter);
    });
  });

  viewToggle.addEventListener("click", (e) => {
    const btn = e.target.closest("[data-view]");
    if (!btn) return;
    if (btn.dataset.view === "list") {
      listWrapper.style.display = "block";
      calendarWrapper.style.display = "none";
    } else {
      listWrapper.style.display = "none";
      calendarWrapper.style.display = "block";
    }
    viewToggle.querySelectorAll("button").forEach((b) => {
      b.classList.toggle("active", b === btn);
    });
  });

  loadTasks();
  updateTzModeUI();
  renderTasks("all");
  </script>
</body>
</html>
